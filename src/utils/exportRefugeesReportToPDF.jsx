// ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
import jsPDF from 'jspdf';
import 'jspdf-autotable';

// ğŸ§  Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ PDF
export const exportRefugeesReportToPDF = async (data) => {
  try {
    if (!data || data.length === 0) {
      alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ PDF');
      return;
    }

    // ğŸ”¹ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ PDF Ø¨ÙˆØ¶Ø¹ Ø£ÙÙ‚ÙŠ (Landscape)
    const doc = new jsPDF({
      orientation: 'landscape',
      unit: 'pt',
      format: 'A4',
    });

    // ğŸ·ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© (Header)
    const title = 'Refugees Detailed Report';
    const generatedDate = new Date().toLocaleString();
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(16);
    doc.text(title, 40, 40);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    doc.text(`Generated on: ${generatedDate}`, 40, 60);

    // ğŸ§¾ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (keys Ù…Ù† Ø£ÙˆÙ„ ØµÙ)
    const columns = Object.keys(data[0]);

    // ğŸ§± ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØµÙÙˆÙ Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
    const rows = data.map((row) => columns.map((col) => (row[col] !== null ? String(row[col]) : '')));

    // ğŸ“Š Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
    doc.autoTable({
      startY: 80,
      head: [columns],
      body: rows,
      styles: {
        fontSize: 8,
        cellPadding: 4,
        overflow: 'linebreak',
        lineColor: [200, 200, 200],
        lineWidth: 0.2,
      },
      headStyles: {
        fillColor: [22, 160, 133],
        textColor: 255,
        fontStyle: 'bold',
      },
      alternateRowStyles: { fillColor: [245, 245, 245] },
      margin: { top: 80, left: 40, right: 40, bottom: 60 },
      didDrawPage: (data) => {
        // âœ… Ø°ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Footer)
        const pageCount = doc.internal.getNumberOfPages();
        doc.setFontSize(9);
        doc.setTextColor(100);
        doc.text(`Page ${pageCount}`, doc.internal.pageSize.getWidth() - 70, doc.internal.pageSize.getHeight() - 30);
        doc.text('Generated by Refugee Management System', 40, doc.internal.pageSize.getHeight() - 30);
      },
    });

    // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    doc.save(`Refugees_Report_${Date.now()}.pdf`);
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ù…Ù„Ù PDF');
  }
};
